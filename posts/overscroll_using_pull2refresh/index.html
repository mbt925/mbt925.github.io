<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Compose your way to overscroll effect with Modifier.pullRefresh - Mohsen Biglari</title><meta name="Description" content="Mohsen Biglari&#39;s personal website"><meta property="og:title" content="Compose your way to overscroll effect with Modifier.pullRefresh" />
<meta property="og:description" content="Jetpack Compose provides OverscrollEffect in androidx.compose.foundation to create customizable overscroll effects. While this works well in many scenarios, integrating it with lazy layout managers like LazyColumn can be less straightforward. A more robust alternative involves using NestedScrollConnection to create a custom overscroll modifier. However, this requires overriding methods like onPreScroll, onPostScroll, and onPreFling, which adds complexity.
Interestingly, Modifier.pullRefresh, while designed for pull-to-refresh functionality, bears similarities with an overscroll modifier, albeit limited to one direction." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://mbt925.github.io/posts/overscroll_using_pull2refresh/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-11-29T00:50:38+01:00" />
<meta property="article:modified_time" content="2024-11-29T00:50:38+01:00" /><meta property="og:site_name" content="My cool site" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Compose your way to overscroll effect with Modifier.pullRefresh"/>
<meta name="twitter:description" content="Jetpack Compose provides OverscrollEffect in androidx.compose.foundation to create customizable overscroll effects. While this works well in many scenarios, integrating it with lazy layout managers like LazyColumn can be less straightforward. A more robust alternative involves using NestedScrollConnection to create a custom overscroll modifier. However, this requires overriding methods like onPreScroll, onPostScroll, and onPreFling, which adds complexity.
Interestingly, Modifier.pullRefresh, while designed for pull-to-refresh functionality, bears similarities with an overscroll modifier, albeit limited to one direction."/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://mbt925.github.io/posts/overscroll_using_pull2refresh/" /><link rel="prev" href="http://mbt925.github.io/posts/caching_made_easy/" /><link rel="next" href="http://mbt925.github.io/posts/uniform_height_lazyrow/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Compose your way to overscroll effect with Modifier.pullRefresh",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/mbt925.github.io\/posts\/overscroll_using_pull2refresh\/"
        },"genre": "posts","wordcount":  1420 ,
        "url": "http:\/\/mbt925.github.io\/posts\/overscroll_using_pull2refresh\/","datePublished": "2024-11-29T00:50:38+01:00","dateModified": "2024-11-29T00:50:38+01:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "mbt925"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Mohsen Biglari">Mohsen Biglari</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Blog </a><a class="menu-item" href="/allprojects/"> Projects </a><a class="menu-item" href="/educations/"> Educations </a><a class="menu-item" href="/academia/"> Academia </a><a class="menu-item" href="/publications/"> Publications </a><a class="menu-item" href="/about/"> About </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Mohsen Biglari">Mohsen Biglari</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Blog</a><a class="menu-item" href="/allprojects/" title="">Projects</a><a class="menu-item" href="/educations/" title="">Educations</a><a class="menu-item" href="/academia/" title="">Academia</a><a class="menu-item" href="/publications/" title="">Publications</a><a class="menu-item" href="/about/" title="">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Compose your way to overscroll effect with Modifier.pullRefresh</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>mbt925</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-11-29">2024-11-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1420 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;7 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/blog/overscroll_using_pull2refresh.webp"
        data-srcset="/images/blog/overscroll_using_pull2refresh.webp, /images/blog/overscroll_using_pull2refresh.webp 1.5x, /images/blog/overscroll_using_pull2refresh.webp 2x"
        data-sizes="auto"
        alt="/images/blog/overscroll_using_pull2refresh.webp"
        title="/images/blog/overscroll_using_pull2refresh.webp" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#creating-a-curved-image-header">Creating a curved image header</a></li>
    <li><a href="#building-the-custom-overscroll-modifier">Building the custom overscroll modifier</a></li>
    <li><a href="#connecting-overscrollstate-and-curvedimage">Connecting OverscrollState and CurvedImage</a></li>
    <li><a href="#integrating-the-overscroll-modifier">Integrating the overscroll modifier</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Jetpack Compose provides <code>OverscrollEffect</code> in <code>androidx.compose.foundation</code> to create customizable overscroll effects.
While this works well in many scenarios, integrating it with lazy layout managers like <code>LazyColumn</code> can be less
straightforward. A more robust alternative involves using <code>NestedScrollConnection</code> to create a custom overscroll modifier.
However, this requires overriding methods like <code>onPreScroll</code>, <code>onPostScroll</code>, and <code>onPreFling</code>, which adds complexity.</p>
<p>Interestingly, <code>Modifier.pullRefresh</code>, while designed for pull-to-refresh functionality, bears similarities
with an overscroll modifier, albeit limited to one direction.
In this blog, we’ll creatively repurpose it to build a custom overscroll modifier and
craft an interactive header as shown below:</p>
<a class="lightgallery" href="/images/blog/overscroll_using_pull2refresh/end_state.gif" title="/images/blog/overscroll_using_pull2refresh/end_state.gif" data-thumbnail="/images/blog/overscroll_using_pull2refresh/end_state.gif">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/blog/overscroll_using_pull2refresh/end_state.gif"
            data-srcset="/images/blog/overscroll_using_pull2refresh/end_state.gif, /images/blog/overscroll_using_pull2refresh/end_state.gif 1.5x, /images/blog/overscroll_using_pull2refresh/end_state.gif 2x"
            data-sizes="auto"
            alt="/images/blog/overscroll_using_pull2refresh/end_state.gif" />
    </a>
<h2 id="creating-a-curved-image-header">Creating a curved image header</h2>
<p>To start, we’ll design a curved path for the header. The function below defines a quadratic Bezier curve from
the bottom left to the bottom right:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">private</span> <span class="k">fun</span> <span class="nf">composeCurvedPath</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">width</span><span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">height</span><span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">curveRatio</span><span class="p">:</span> <span class="n">Float</span> <span class="p">=</span> <span class="m">1f</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">.</span><span class="n">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Move to the bottom left corner
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">path</span><span class="p">.</span><span class="n">moveTo</span><span class="p">(</span><span class="m">0f</span><span class="p">,</span> <span class="n">height</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Define a quadratic bezier curve from bottom left to bottom right
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">path</span><span class="p">.</span><span class="n">quadraticTo</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">x1</span> <span class="p">=</span> <span class="n">width</span> <span class="p">/</span> <span class="m">2</span><span class="p">,</span> <span class="c1">// Control point X
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">y1</span> <span class="p">=</span> <span class="p">(</span><span class="n">height</span> <span class="p">-</span> <span class="n">height</span> <span class="p">*</span> <span class="n">curveRatio</span><span class="p">),</span> <span class="c1">// Control point Y
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">x2</span> <span class="p">=</span> <span class="n">width</span> <span class="p">+</span> <span class="m">1</span><span class="p">,</span> <span class="c1">// End point X
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">y2</span> <span class="p">=</span> <span class="n">height</span> <span class="p">+</span> <span class="m">1</span><span class="p">,</span> <span class="c1">// End point Y
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Close the path back to the starting point
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">path</span><span class="p">.</span><span class="n">lineTo</span><span class="p">(</span><span class="m">0f</span><span class="p">,</span> <span class="n">height</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>The <code>curveRatio</code> determines the curve’s shape. A value of 1 creates a full curve, while 0 flattens it into a straight line.
Using this path, we’ll create a composable that draws the path with a solid color:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * This view draws a curved arc
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param color: the filled color of the curve
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param curveRatio: a ratio of 1 means a complete curve, and a ratio of 0 means a flat line
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Composable</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span> <span class="k">fun</span> <span class="nf">CurvedBackground</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">color</span><span class="p">:</span> <span class="n">Color</span> <span class="p">=</span> <span class="nc">MaterialTheme</span><span class="p">.</span><span class="n">colorScheme</span><span class="p">.</span><span class="n">surface</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">curveRatio</span><span class="p">:</span> <span class="n">Float</span> <span class="p">=</span> <span class="m">1f</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Box</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">.</span><span class="n">drawWithCache</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">val</span> <span class="py">hasValidCurveParams</span> <span class="p">=</span> <span class="n">size</span><span class="p">.</span><span class="n">minDimension</span> <span class="p">&gt;</span> <span class="m">0f</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(!</span><span class="n">hasValidCurveParams</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">onDrawWithContent</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">val</span> <span class="py">paint</span> <span class="p">=</span> <span class="n">Paint</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">isAntiAlias</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl">                    <span class="k">this</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="n">color</span>
</span></span><span class="line"><span class="cl">                    <span class="n">style</span> <span class="p">=</span> <span class="nc">PaintingStyle</span><span class="p">.</span><span class="n">Fill</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">val</span> <span class="py">path</span> <span class="p">=</span> <span class="n">Path</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">composeCurvedPath</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">width</span> <span class="p">=</span> <span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">height</span> <span class="p">=</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">path</span> <span class="p">=</span> <span class="n">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">curveRatio</span> <span class="p">=</span> <span class="n">curveRatio</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">onDrawWithContent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">drawIntoCanvas</span> <span class="p">{</span> <span class="n">canvas</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="n">canvas</span><span class="p">.</span><span class="n">drawPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">paint</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>Here is how it looks using a green background color and a red fill color with a <code>curveRatio</code> of 0 and 1 respectively:</p>
<a class="lightgallery" href="/images/blog/overscroll_using_pull2refresh/curve_preview.webp" title="/images/blog/overscroll_using_pull2refresh/curve_preview.webp" data-thumbnail="/images/blog/overscroll_using_pull2refresh/curve_preview.webp">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/blog/overscroll_using_pull2refresh/curve_preview.webp"
            data-srcset="/images/blog/overscroll_using_pull2refresh/curve_preview.webp, /images/blog/overscroll_using_pull2refresh/curve_preview.webp 1.5x, /images/blog/overscroll_using_pull2refresh/curve_preview.webp 2x"
            data-sizes="auto"
            alt="/images/blog/overscroll_using_pull2refresh/curve_preview.webp" />
    </a>
<p>This allows us to create a visually appealing curved header by putting the curve at the bottom of an image:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nd">@Composable</span>
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">CurvedImage</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@DrawableRes</span> <span class="n">imageRes</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Box</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">background</span><span class="p">(</span><span class="nc">MaterialTheme</span><span class="p">.</span><span class="n">colorScheme</span><span class="p">.</span><span class="n">surface</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">clipToBounds</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Image</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">modifier</span> <span class="p">=</span> <span class="nc">Modifier</span><span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="n">painter</span> <span class="p">=</span> <span class="n">painterResource</span><span class="p">(</span><span class="n">imageRes</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">contentDescription</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">contentScale</span> <span class="p">=</span> <span class="nc">ContentScale</span><span class="p">.</span><span class="n">FillWidth</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">CurvedBackground</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">align</span><span class="p">(</span><span class="n">BottomCenter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">height</span><span class="p">(</span><span class="m">50.</span><span class="n">dp</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">curveRatio</span> <span class="p">=</span> <span class="m">1f</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<a class="lightgallery" href="/images/blog/overscroll_using_pull2refresh/curved_image_preview.webp" title="/images/blog/overscroll_using_pull2refresh/curved_image_preview.webp" data-thumbnail="/images/blog/overscroll_using_pull2refresh/curved_image_preview.webp">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/blog/overscroll_using_pull2refresh/curved_image_preview.webp"
            data-srcset="/images/blog/overscroll_using_pull2refresh/curved_image_preview.webp, /images/blog/overscroll_using_pull2refresh/curved_image_preview.webp 1.5x, /images/blog/overscroll_using_pull2refresh/curved_image_preview.webp 2x"
            data-sizes="auto"
            alt="/images/blog/overscroll_using_pull2refresh/curved_image_preview.webp" />
    </a>
<h2 id="building-the-custom-overscroll-modifier">Building the custom overscroll modifier</h2>
<p>Let&rsquo;s look into <code>Modifier.pullRefresh</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">Modifier</span><span class="p">.</span><span class="n">pullRefresh</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">state</span><span class="p">:</span> <span class="n">PullRefreshState</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">enabled</span><span class="p">:</span> <span class="n">Boolean</span> <span class="p">=</span> <span class="k">true</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">=</span> <span class="n">pullRefresh</span><span class="p">(</span><span class="n">state</span><span class="o">::</span><span class="n">onPull</span><span class="p">,</span> <span class="n">state</span><span class="o">::</span><span class="n">onRelease</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>The <code>Modifier.pullRefresh</code> relies on an associated <code>PullRefreshState</code>. Let’s simplify it into an <code>OverscrollState</code>
tailored to our use case:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * A state object that can be used in conjunction with [overscroll] to add overscroll
</span></span></span><span class="line"><span class="cl"><span class="cm"> * behaviour to a scrollable component.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Provides [progress], a float representing how far the user has over scrolled as a percentage
</span></span></span><span class="line"><span class="cl"><span class="cm"> * of the [threshold]. Also provides the over scrolled [offset].
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Should be created using [rememberOverscrollState].
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Stable</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OverscrollState</span> <span class="k">internal</span> <span class="k">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">val</span> <span class="py">animationScope</span><span class="p">:</span> <span class="n">CoroutineScope</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">val</span> <span class="py">threshold</span><span class="p">:</span> <span class="n">Float</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">val</span> <span class="py">offset</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">position</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">progress</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">position</span> <span class="p">/</span> <span class="n">threshold</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">var</span> <span class="py">position</span> <span class="k">by</span> <span class="n">mutableFloatStateOf</span><span class="p">(</span><span class="m">0f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">var</span> <span class="py">distancePulled</span> <span class="k">by</span> <span class="n">mutableFloatStateOf</span><span class="p">(</span><span class="m">0f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">internal</span> <span class="k">fun</span> <span class="nf">onPull</span><span class="p">(</span><span class="n">pullDelta</span><span class="p">:</span> <span class="n">Float</span><span class="p">):</span> <span class="n">Float</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">newOffset</span> <span class="p">=</span> <span class="p">(</span><span class="n">distancePulled</span> <span class="p">+</span> <span class="n">pullDelta</span><span class="p">).</span><span class="n">coerceAtLeast</span><span class="p">(</span><span class="m">0f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">dragConsumed</span> <span class="p">=</span> <span class="n">newOffset</span> <span class="p">-</span> <span class="n">distancePulled</span>
</span></span><span class="line"><span class="cl">        <span class="n">distancePulled</span> <span class="p">=</span> <span class="n">newOffset</span>
</span></span><span class="line"><span class="cl">        <span class="n">position</span> <span class="p">=</span> <span class="p">(</span><span class="n">distancePulled</span> <span class="p">*</span> <span class="n">DRAG_MULTIPLIER</span><span class="p">).</span><span class="n">coerceAtMost</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">dragConsumed</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">internal</span> <span class="k">fun</span> <span class="nf">onRelease</span><span class="p">(</span><span class="n">velocity</span><span class="p">:</span> <span class="n">Float</span><span class="p">):</span> <span class="n">Float</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">animateIndicatorTo</span><span class="p">(</span><span class="m">0f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">consumed</span> <span class="p">=</span> <span class="k">when</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// We are flinging without having dragged it down first (for example a fling inside
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// a list) - don&#39;t consume
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">distancePulled</span> <span class="o">==</span> <span class="m">0f</span> <span class="o">-&gt;</span> <span class="m">0f</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// If the velocity is negative, the fling is upwards, and we don&#39;t want to prevent the
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// the list from scrolling
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">velocity</span> <span class="p">&lt;</span> <span class="m">0f</span> <span class="o">-&gt;</span> <span class="m">0f</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// It&#39;s already dragged down, and the fling is downwards - consume everything
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">else</span> <span class="o">-&gt;</span> <span class="n">velocity</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">distancePulled</span> <span class="p">=</span> <span class="m">0f</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">consumed</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Make sure to cancel any existing animations when we launch a new one. We use this instead of
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Animatable as calling snapTo() on every drag delta has a one frame delay, and some extra
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// overhead of running through the animation pipeline instead of directly mutating the state.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">private</span> <span class="k">val</span> <span class="py">mutatorMutex</span> <span class="p">=</span> <span class="n">MutatorMutex</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span> <span class="k">fun</span> <span class="nf">animateIndicatorTo</span><span class="p">(</span><span class="n">offset</span><span class="p">:</span> <span class="n">Float</span><span class="p">)</span> <span class="p">=</span> <span class="n">animationScope</span><span class="p">.</span><span class="n">launch</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">mutatorMutex</span><span class="p">.</span><span class="n">mutate</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">animate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">initialValue</span> <span class="p">=</span> <span class="n">position</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">targetValue</span> <span class="p">=</span> <span class="n">offset</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span> <span class="p">{</span> <span class="k">value</span><span class="p">,</span> <span class="n">_</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="n">position</span> <span class="p">=</span> <span class="k">value</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">object</span> <span class="nc">OverscrollStateDefaults</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * The distance pulled is multiplied by this value to give us the adjusted distance pulled,
</span></span></span><span class="line"><span class="cl"><span class="cm">     * which is used in calculating the offset
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="k">val</span> <span class="py">DRAG</span><span class="n">_MULTIPLIER</span> <span class="p">=</span> <span class="m">0.5f</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>Since we only need the <code>progress</code> property, all unrelated logic has been removed.
With this simplified state object, we can replicate the behavior of <code>Modifier.pullRefresh</code>
using our custom <code>OverscrollState</code> instance:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Adds overscroll behavior to a scrollable component.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">Modifier</span><span class="p">.</span><span class="n">overscroll</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">state</span><span class="p">:</span> <span class="n">OverscrollState</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">enabled</span><span class="p">:</span> <span class="n">Boolean</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">=</span> <span class="n">pullRefresh</span><span class="p">(</span><span class="n">state</span><span class="o">::</span><span class="n">onPull</span><span class="p">,</span> <span class="n">state</span><span class="o">::</span><span class="n">onRelease</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>Next, we need to provide a way to create a state object similar to <code>rememberPullRefreshState</code> but way simpler:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Creates an OverscrollState that is remembered across compositions.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Composable</span>
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">rememberOverscrollState</span><span class="p">():</span> <span class="n">OverscrollState</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">scope</span> <span class="p">=</span> <span class="n">rememberCoroutineScope</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">thresholdPx</span> <span class="p">=</span> <span class="n">with</span><span class="p">(</span><span class="nc">LocalDensity</span><span class="p">.</span><span class="n">current</span><span class="p">)</span> <span class="p">{</span> <span class="nc">OverscrollStateDefaults</span><span class="p">.</span><span class="nc">THRESHOLD</span><span class="p">.</span><span class="n">toPx</span><span class="p">()</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">state</span> <span class="p">=</span> <span class="n">remember</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">OverscrollState</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">animationScope</span> <span class="p">=</span> <span class="n">scope</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">threshold</span> <span class="p">=</span> <span class="n">thresholdPx</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">state</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">internal</span> <span class="k">object</span> <span class="nc">OverscrollStateDefaults</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * The maximum allowed over scroll distance
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">THRESHOLD</span> <span class="p">=</span> <span class="m">80.</span><span class="n">dp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="connecting-overscrollstate-and-curvedimage">Connecting OverscrollState and CurvedImage</h2>
<p>The <code>OverscrollState</code> can be easily passed into <code>CurvedImage</code> as shown below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nd">@Composable</span>
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">CurvedImage</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@DrawableRes</span> <span class="n">imageRes</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">overscrollState</span><span class="p">:</span> <span class="n">OverscrollState</span> <span class="p">=</span> <span class="n">rememberOverscrollState</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Box</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">background</span><span class="p">(</span><span class="nc">MaterialTheme</span><span class="p">.</span><span class="n">colorScheme</span><span class="p">.</span><span class="n">surface</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">clipToBounds</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Image</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">graphicsLayer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">scaleX</span> <span class="p">=</span> <span class="m">1</span> <span class="p">+</span> <span class="n">overscrollState</span><span class="p">.</span><span class="n">progress</span>
</span></span><span class="line"><span class="cl">                    <span class="n">scaleY</span> <span class="p">=</span> <span class="m">1</span> <span class="p">+</span> <span class="n">overscrollState</span><span class="p">.</span><span class="n">progress</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="n">painter</span> <span class="p">=</span> <span class="n">painterResource</span><span class="p">(</span><span class="n">imageRes</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">contentDescription</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">contentScale</span> <span class="p">=</span> <span class="nc">ContentScale</span><span class="p">.</span><span class="n">FillWidth</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">CurvedBackground</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">align</span><span class="p">(</span><span class="n">BottomCenter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">height</span><span class="p">(</span><span class="m">50.</span><span class="n">dp</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">curveRatio</span> <span class="p">=</span> <span class="m">1</span> <span class="p">-</span> <span class="n">overscrollState</span><span class="p">.</span><span class="n">progress</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>The <code>overscrollState.progress</code> dynamically scales up the header image during over-scrolling
while flattening the curve proportionally.</p>
<h2 id="integrating-the-overscroll-modifier">Integrating the overscroll modifier</h2>
<p>With everything in place, we can now apply the custom modifier to a scrollable screen:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="nd">@Composable</span>
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">ScrollableScreen</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">overscrollState</span> <span class="p">=</span> <span class="n">rememberOverscrollState</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">Scaffold</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">overscroll</span><span class="p">(</span><span class="n">overscrollState</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">fillMaxSize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">{</span> <span class="n">innerPadding</span> <span class="o">-&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="n">LazyColumn</span><span class="p">(</span><span class="nc">Modifier</span><span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="n">innerPadding</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">item</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">CurvedImage</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                    <span class="n">overscrollState</span> <span class="p">=</span> <span class="n">overscrollState</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">imageRes</span> <span class="p">=</span> <span class="nc">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">img1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">repeat</span><span class="p">(</span><span class="m">20</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">item</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Text</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                        <span class="n">modifier</span> <span class="p">=</span> <span class="nc">Modifier</span><span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                        <span class="n">text</span> <span class="p">=</span> <span class="s2">&#34;Item </span><span class="si">$it</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>With just a few lines of code, we’ve successfully integrated a custom overscroll effect and
a visually appealing curved header into our app.</p>
<a class="lightgallery" href="/images/blog/overscroll_using_pull2refresh/end_state.gif" title="/images/blog/overscroll_using_pull2refresh/end_state.gif" data-thumbnail="/images/blog/overscroll_using_pull2refresh/end_state.gif">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/blog/overscroll_using_pull2refresh/end_state.gif"
            data-srcset="/images/blog/overscroll_using_pull2refresh/end_state.gif, /images/blog/overscroll_using_pull2refresh/end_state.gif 1.5x, /images/blog/overscroll_using_pull2refresh/end_state.gif 2x"
            data-sizes="auto"
            alt="/images/blog/overscroll_using_pull2refresh/end_state.gif" />
    </a>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-11-29</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://mbt925.github.io/posts/overscroll_using_pull2refresh/" data-title="Compose your way to overscroll effect with Modifier.pullRefresh"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://mbt925.github.io/posts/overscroll_using_pull2refresh/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="http://mbt925.github.io/posts/overscroll_using_pull2refresh/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="http://mbt925.github.io/posts/overscroll_using_pull2refresh/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/caching_made_easy/" class="prev" rel="prev" title="Caching made easy"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Caching made easy</a>
            <a href="/posts/uniform_height_lazyrow/" class="next" rel="next" title="Uniform Height LazyRow in Jetpack Compose">Uniform Height LazyRow in Jetpack Compose<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer" onload="showAge()">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2025</span>&nbsp;|&nbsp;<span class="license">Mohsen Biglari</span></div>
        </div>

        <script type="text/javascript">
            window.onload = (function () {
                showAge()
            });
        </script>

        <script defer language="javascript" type="text/javascript"  src="/js/age.js"></script>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":30},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
